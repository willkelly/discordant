{"version":3,"file":"utils.min.js","sources":["../src/index.tsx"],"sourcesContent":["import { ReadonlySignal, Signal } from \"@preact/signals-core\";\nimport { useSignal } from \"@preact/signals\";\nimport { Fragment, createElement, JSX } from \"preact\";\nimport { useMemo } from \"preact/hooks\";\n\ninterface ShowProps<T = boolean> {\n\twhen: Signal<T> | ReadonlySignal<T>;\n\tfallback?: JSX.Element;\n\tchildren: JSX.Element | ((value: NonNullable<T>) => JSX.Element);\n}\n\nconst Item = (props: any) => {\n\tconst result =\n\t\ttypeof props.children === \"function\"\n\t\t\t? props.children(props.v, props.i)\n\t\t\t: props.children;\n\tif (props.cache) {\n\t\tprops.cache.set(props.v, result);\n\t}\n\treturn result;\n};\n\nexport function Show<T = boolean>(props: ShowProps<T>): JSX.Element | null {\n\tconst value = props.when.value;\n\tif (!value) return props.fallback || null;\n\treturn <Item v={value} children={props.children} />;\n}\n\ninterface ForProps<T> {\n\teach:\n\t\t| Signal<Array<T>>\n\t\t| ReadonlySignal<Array<T>>\n\t\t| (() => Signal<Array<T>> | ReadonlySignal<Array<T>>);\n\tfallback?: JSX.Element;\n\tchildren: (value: T, index: number) => JSX.Element;\n}\n\nexport function For<T>(props: ForProps<T>): JSX.Element | null {\n\tconst cache = useMemo(() => new Map(), []);\n\tlet list = (\n\t\t(typeof props.each === \"function\" ? props.each() : props.each) as Signal<\n\t\t\tArray<T>\n\t\t>\n\t).value;\n\n\tif (!list.length) return props.fallback || null;\n\n\tconst items = list.map((value, key) => {\n\t\tif (!cache.has(value)) {\n\t\t\treturn <Item v={value} i={key} children={props.children} cache={cache} />;\n\t\t}\n\t\treturn cache.get(value);\n\t});\n\n\treturn createElement(Fragment, null, items);\n}\n\nexport function useLiveSignal<T>(\n\tvalue: Signal<T> | ReadonlySignal<T>\n): Signal<Signal<T> | ReadonlySignal<T>> {\n\tconst s = useSignal(value);\n\tif (s.peek() !== value) s.value = value;\n\treturn s;\n}\n\nexport function useSignalRef<T>(value: T): Signal<T> & { current: T } {\n\tconst ref = useSignal(value) as Signal<T> & { current: T };\n\tif (!(\"current\" in ref))\n\t\tObject.defineProperty(ref, \"current\", refSignalProto);\n\treturn ref;\n}\nconst refSignalProto = {\n\tconfigurable: true,\n\tget(this: Signal) {\n\t\treturn this.value;\n\t},\n\tset(this: Signal, v: any) {\n\t\tthis.value = v;\n\t},\n};\n"],"names":["g","f","exports","module","require","define","amd","globalThis","self","preactSignalsutils","signals","preact","preactHooks","this","hooks","Item","props","result","children","v","i","cache","set","refSignalProto","configurable","get","value","For","useMemo","Map","list","each","length","fallback","items","map","key","has","createElement","Fragment","Show","when","useLiveSignal","s","useSignal","peek","useSignalRef","ref","Object","defineProperty"],"mappings":"CAWA,SAAAA,EAAAC,GAAA,iBAAAC,SAAA,oBAAAC,OAAAF,EAAAC,QAAAE,QAAA,mBAAAA,QAAA,UAAAA,QAAA,iBAAA,mBAAAC,QAAAA,OAAAC,IAAAD,OAAA,CAAA,UAAA,kBAAA,SAAA,gBAAAJ,GAAAA,GAAAD,EAAA,oBAAAO,WAAAA,WAAAP,GAAAQ,MAAAC,mBAAA,CAAA,EAAAT,EAAAU,QAAAV,EAAAW,OAAAX,EAAAY,YAAA,CAAA,CAAAC,KAAA,SAAAX,EAAAQ,EAAAC,EAAAG,GAAA,IAAMC,EAAO,SAACC,GACb,IAAMC,EACqB,mBAAnBD,EAAME,SACVF,EAAME,SAASF,EAAMG,EAAGH,EAAMI,GAC9BJ,EAAME,SACV,GAAIF,EAAMK,MACTL,EAAMK,MAAMC,IAAIN,EAAMG,EAAGF,GAE1B,OAAOA,CACR,EAmDMM,EAAiB,CACtBC,cAAc,EACdC,IAAG,WACF,YAAYC,KACb,EACAJ,aAAkBH,GACjBN,KAAKa,MAAQP,CACd,GACAjB,EAAAyB,aA1CsBX,GACtB,IAAMK,EAAQO,EAAAA,QAAQ,WAAM,OAAA,IAAIC,GAAK,EAAE,IACnCC,GACoB,mBAAfd,EAAMe,KAAsBf,EAAMe,OAASf,EAAMe,MAGxDL,MAEF,IAAKI,EAAKE,OAAQ,OAAOhB,EAAMiB,UAAY,KAE3C,IAAMC,EAAQJ,EAAKK,IAAI,SAACT,EAAOU,GAC9B,IAAKf,EAAMgB,IAAIX,GACd,OAAOY,EAAAA,cAACvB,EAAK,CAAAI,EAAGO,EAAON,EAAGgB,EAAKlB,SAAUF,EAAME,SAAUG,MAAOA,SAEjE,OAAOA,EAAMI,IAAIC,EAClB,GAEA,OAAOY,EAAAA,cAAcC,EAAQA,SAAE,KAAML,EACtC,EAwBChC,EAAAsC,KAzDe,SAAkBxB,GACjC,IAAMU,EAAQV,EAAMyB,KAAKf,MACzB,IAAKA,EAAO,OAAOV,EAAMiB,UAAY,UACrC,OAAOK,EAACA,cAAAvB,EAAK,CAAAI,EAAGO,EAAOR,SAAUF,EAAME,UACxC,EAqDChB,EAAAwC,uBArBAhB,GAEA,IAAMiB,EAAIC,EAAAA,UAAUlB,GACpB,GAAIiB,EAAEE,SAAWnB,EAAOiB,EAAEjB,MAAQA,EAClC,OAAOiB,CACR,EAgBCzC,EAAA4C,aAde,SAAgBpB,GAC/B,IAAMqB,EAAMH,EAAAA,UAAUlB,GACtB,KAAM,YAAaqB,GAClBC,OAAOC,eAAeF,EAAK,UAAWxB,GACvC,OAAOwB,CACR,CASC"}